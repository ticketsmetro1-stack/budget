<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Budget App (EGP)</title>
  <style>
    :root{ --bg:#f6f7fb; --card:#fff; --muted:#6b7280; --accent:#2563eb; }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    body{margin:0;background:var(--bg);color:#0f172a;padding:18px;}
    h1{margin:0 0 12px;text-align:center;font-size:20px;}
    .form-card{max-width:720px;margin:0 auto 18px;background:var(--card);padding:14px;border-radius:12px;box-shadow:0 4px 20px rgba(16,24,40,0.04);}
    .row{display:flex;gap:10px;align-items:center;}
    .col{display:flex;flex-direction:column;gap:8px;}
    input, select{padding:10px;border-radius:10px;border:1px solid #e6e9ef;font-size:15px;width:100%;}
    button.primary{background:var(--accent);color:#fff;border:0;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer;}
    .small{font-size:13px;color:var(--muted);}
    .goals-container{max-width:980px;margin:0 auto;display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px;}
    .goal-card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 4px 14px rgba(16,24,40,0.04);position:relative;}
    .goal-title{font-weight:700;font-size:18px;margin:0 0 6px;}
    .muted{color:var(--muted);font-size:14px;margin:2px 0;}
    .progress-row{display:flex;align-items:center;gap:10px;margin-top:8px;}
    .bar-wrap{flex:1;background:#eef2ff;border-radius:999px;padding:6px;}
    .bar{height:12px;border-radius:999px;width:0%;transition:width .25s ease;}
    .percent{min-width:40px;text-align:right;font-weight:600;font-size:13px;color:#0f172a;}
    .card-actions{display:flex;gap:8px;margin-top:12px;}
    .card-actions button{flex:1;padding:10px;border-radius:10px;border:1px solid #e6e9ef;background:#fff;cursor:pointer;font-weight:700;}
    .btn-add{background:#10b981;color:#fff;border:0;}
    .btn-edit{background:#f59e0b;color:#fff;border:0;}
    .delete-icon{position:absolute;right:10px;top:10px;border:0;background:transparent;cursor:pointer;font-size:16px;color:#b91c1c;}
    @media (max-width:600px){.goals-container{grid-template-columns:repeat(2,1fr);}}
  </style>
</head>
<body>
  <h1>üí∞ Budget App (EGP)</h1>

  <div class="form-card">
    <div class="col">
      <label class="small">Goal name</label>
      <input id="goalName" type="text" placeholder="e.g., Laptop">
      <label class="small">Goal amount (EGP)</label>
      <input id="goalAmount" type="number" placeholder="5000">
      <label class="small">Color</label>
      <div class="row">
        <input id="goalColor" type="color" value="#10b981" style="width:64px;padding:8px;">
        <div style="flex:1"></div>
        <button class="primary" id="addGoalBtn">Add Goal</button>
      </div>
    </div>
  </div>

  <div class="goals-container" id="goalsContainer"></div>

  <script>
    const STORAGE_KEY = 'budgetGoals';
    let goals = [];

    function saveData(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(goals)); }
    function loadData(){
      try{ goals = JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
      catch(e){ goals = []; }
      renderGoals();
    }
    function uid(){ return Date.now() + Math.floor(Math.random()*1000); }

    function addGoalFromForm(){
      const name = document.getElementById('goalName').value.trim();
      const target = Number(document.getElementById('goalAmount').value);
      const color = document.getElementById('goalColor').value;
      if(!name || target<=0) return alert("Enter valid name & amount");
      goals.push({ id:uid(), name, target, saved:0, color });
      saveData(); renderGoals();
      document.getElementById('goalName').value='';
      document.getElementById('goalAmount').value='';
    }
    document.getElementById('addGoalBtn').addEventListener('click', addGoalFromForm);

    function addSavings(id){
      const g = goals.find(x=>x.id===id); if(!g) return;
      const amt = Number(prompt("Add amount (EGP)"));
      if(isNaN(amt)||amt<=0) return;
      g.saved += amt; saveData(); renderGoals();
    }
    function editGoal(id){
      const g = goals.find(x=>x.id===id); if(!g) return;
      const newName = prompt("Edit name", g.name);
      const newTarget = Number(prompt("Edit target", g.target));
      if(newName) g.name=newName.trim();
      if(newTarget>0) g.target=newTarget;
      saveData(); renderGoals();
    }
    function deleteGoal(id){
      if(!confirm("Delete this goal?")) return;
      goals=goals.filter(x=>x.id!==id); saveData(); renderGoals();
    }

    function renderGoals(){
      const container=document.getElementById('goalsContainer');
      container.innerHTML='';
      if(goals.length===0){container.innerHTML='<div style="grid-column:1/-1;text-align:center;color:var(--muted)">No goals yet</div>';return;}
      goals.forEach(g=>{
        const remaining=Math.max(g.target-g.saved,0);
        const percent=g.target?Math.min(100,Math.round(g.saved/g.target*100)):0;
        const card=document.createElement('div');
        card.className='goal-card';
        card.innerHTML=`
          <button class="delete-icon" onclick="deleteGoal(${g.id})">üóë</button>
          <div class="goal-title">üéØ ${g.name}</div>
          <div class="muted">Target: ${g.target} EGP</div>
          <div class="muted">Saved: ${g.saved} EGP</div>
          <div class="muted">Remaining: ${remaining} EGP</div>
          <div class="progress-row">
            <div class="bar-wrap"><div class="bar" style="width:${percent}%;background:${g.color};"></div></div>
            <div class="percent">${percent}%</div>
          </div>
          <div class="card-actions">
            <button class="btn-add" onclick="addSavings(${g.id})">+ Add</button>
            <button class="btn-edit" onclick="editGoal(${g.id})">‚úèÔ∏è Edit</button>
          </div>`;
        container.appendChild(card);
      });
    }

    // ‚úÖ Shortcut handler
    function handleShortcutEntry() {
      const params = new URLSearchParams(window.location.search);
      const entry = params.get("entry");
      if (!entry) return;

      const parts = entry.trim().split(/\s+/);
      const amount = Number(parts.pop());
      const name = parts.join(" ");

      if (!name || isNaN(amount)) return alert("Invalid shortcut input");

      let g = goals.find(x=>x.name.toLowerCase()===name.toLowerCase());
      if (g) {
        g.saved += amount;
        alert(`Added ${amount} EGP to ${g.name}`);
      } else {
        goals.push({ id:uid(), name, target:amount, saved:0, color:"#10b981" });
        alert(`Created goal ${name} with target ${amount} EGP`);
      }
      saveData(); renderGoals();
    }

    loadData();
    handleShortcutEntry();
  </script>
</body>
</html>
