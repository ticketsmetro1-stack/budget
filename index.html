<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Budget App</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    h1 { text-align: center; }
    .goal-form { margin: 20px auto; max-width: 400px; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .goal-form input, .goal-form select, .goal-form button {
      margin: 8px 0; padding: 10px; width: 100%; border-radius: 5px; border: 1px solid #ccc;
    }
    .goals-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .goal-card {
      background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .progress { height: 20px; background: #ddd; border-radius: 5px; overflow: hidden; margin: 10px 0; }
    .bar { height: 100%; width: 0%; transition: width 0.3s ease-in-out; }
    .actions button { margin: 5px 5px 0 0; padding: 6px 10px; border: none; border-radius: 5px; cursor: pointer; }
    .actions .edit { background: #f0ad4e; color: white; }
    .actions .delete { background: #d9534f; color: white; }
  </style>
</head>
<body>
  <h1>üí∞ Budget App (EGP)</h1>

  <div class="goal-form">
    <input id="goalName" placeholder="Goal name (e.g. Laptop)">
    <input id="goalAmount" type="number" placeholder="Goal amount (EGP)">
    <select id="goalColor">
      <option value="green">Green</option>
      <option value="blue">Blue</option>
      <option value="purple">Purple</option>
      <option value="orange">Orange</option>
      <option value="red">Red</option>
    </select>
    <button onclick="addGoal()">Add Goal</button>
  </div>

  <div class="goals-container" id="goalsContainer"></div>

  <script>
    let goals = [];

    function saveData() {
      localStorage.setItem("budgetGoals", JSON.stringify(goals));
    }

    function loadData() {
      const data = localStorage.getItem("budgetGoals");
      if (data) goals = JSON.parse(data);
      renderGoals();
    }

    function addGoal() {
      const name = document.getElementById("goalName").value;
      const amount = parseFloat(document.getElementById("goalAmount").value);
      const color = document.getElementById("goalColor").value;

      if (!name || isNaN(amount) || amount <= 0) return alert("Enter valid goal");

      goals.push({ id: Date.now(), name, target: amount, saved: 0, color });
      saveData();
      renderGoals();

      document.getElementById("goalName").value = "";
      document.getElementById("goalAmount").value = "";
    }

    function addSavings(id) {
      const amount = parseFloat(prompt("Enter amount to add:"));
      if (isNaN(amount) || amount <= 0) return;
      const goal = goals.find(g => g.id === id);
      goal.saved += amount;
      saveData();
      renderGoals();
    }

    function editGoal(id) {
      const goal = goals.find(g => g.id === id);
      const newName = prompt("Edit goal name:", goal.name);
      const newTarget = parseFloat(prompt("Edit target amount:", goal.target));
      if (newName) goal.name = newName;
      if (!isNaN(newTarget) && newTarget > 0) goal.target = newTarget;
      saveData();
      renderGoals();
    }

    function deleteGoal(id) {
      goals = goals.filter(g => g.id !== id);
      saveData();
      renderGoals();
    }

    function renderGoals() {
      const container = document.getElementById("goalsContainer");
      container.innerHTML = "";
      goals.forEach(goal => {
        const percent = Math.min((goal.saved / goal.target) * 100, 100);
        container.innerHTML += `
          <div class="goal-card">
            <h3>üéØ ${goal.name}</h3>
            <p>Target: ${goal.target} EGP</p>
            <p>Saved: ${goal.saved} EGP</p>
            <p>Remaining: ${Math.max(goal.target - goal.saved, 0)} EGP</p>
            <div class="progress"><div class="bar" style="width:${percent}%; background:${goal.color};"></div></div>
            <div class="actions">
              <button onclick="addSavings(${goal.id})">+ Add</button>
              <button class="edit" onclick="editGoal(${goal.id})">‚úèÔ∏è Edit</button>
              <button class="delete" onclick="deleteGoal(${goal.id})">üóë Delete</button>
            </div>
          </div>
        `;
      });
    }

    loadData();

    // Offline support
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js');
    }
  </script>
</body>
</html>
